(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{1486:function(e,t,o){var n=o(12);o(1487),o(1488),o(1489);var d=o(1490),r=o(1491);n.registerLayout(d),n.registerVisual(r)},1487:function(e,t,o){var n=o(87),d=o(748),r=o(63).encodeHTML,l=o(81),c=(o(49).__DEV__,n.extend({type:"series.sankey",layoutInfo:null,levelModels:null,getInitialData:function(option,e){for(var t=option.edges||option.links,o=option.data||option.nodes,n=option.levels,r=this.levelModels={},i=0;i<n.length;i++)null!=n[i].depth&&n[i].depth>=0&&(r[n[i].depth]=new l(n[i],this,e));if(o&&t)return d(o,t,this,!0,(function(e,t){e.wrapMethod("getItemModel",(function(e,t){return e.customizeGetParent((function(path){var e=this.parentModel,o=e.getData().getItemLayout(t).depth;return e.levelModels[o]||this.parentModel})),e})),t.wrapMethod("getItemModel",(function(e,t){return e.customizeGetParent((function(path){var e=this.parentModel,o=e.getGraph().getEdgeByIndex(t).node1.getLayout().depth;return e.levelModels[o]||this.parentModel})),e}))})).data},setNodePosition:function(e,t){var o=this.option.data[e];o.localX=t[0],o.localY=t[1]},getGraph:function(){return this.getData().graph},getEdgeData:function(){return this.getGraph().edgeData},formatTooltip:function(e,t,o){if("edge"===o){var n=this.getDataParams(e,o),d=n.data,html=d.source+" -- "+d.target;return n.value&&(html+=" : "+n.value),r(html)}if("node"===o){var l=this.getGraph().getNodeByIndex(e).getLayout().value,y=this.getDataParams(e,o).data.name;if(l)html=y+" : "+l;return r(html)}return c.superCall(this,"formatTooltip",e,t)},optionUpdated:function(){var option=this.option;!0===option.focusNodeAdjacency&&(option.focusNodeAdjacency="allEdges")},getDataParams:function(e,t){var o=c.superCall(this,"getDataParams",e,t);if(null==o.value&&"node"===t){var n=this.getGraph().getNodeByIndex(e).getLayout().value;o.value=n}return o},defaultOption:{zlevel:0,z:2,coordinateSystem:"view",layout:null,left:"5%",top:"5%",right:"20%",bottom:"5%",orient:"horizontal",nodeWidth:20,nodeGap:8,draggable:!0,focusNodeAdjacency:!1,layoutIterations:32,label:{show:!0,position:"right",color:"#000",fontSize:12},levels:[],nodeAlign:"justify",itemStyle:{borderWidth:1,borderColor:"#333"},lineStyle:{color:"#314656",opacity:.2,curveness:.5},emphasis:{label:{show:!0},lineStyle:{opacity:.5}},animationEasing:"linear",animationDuration:1e3}})),y=c;e.exports=y},1488:function(e,t,o){var n=o(16),d=o(12),r=o(1),l=["itemStyle","opacity"],c=["emphasis","itemStyle","opacity"],y=["lineStyle","opacity"],h=["emphasis","lineStyle","opacity"];function f(e,t){return e.getVisual("opacity")||e.getModel().get(t)}function v(e,t,o){var n=e.getGraphicEl(),d=f(e,t);null!=o&&(null==d&&(d=1),d*=o),n.downplay&&n.downplay(),n.traverse((function(e){"group"!==e.type&&e.setStyle("opacity",d)}))}function x(e,t){var o=f(e,t),n=e.getGraphicEl();n.traverse((function(e){"group"!==e.type&&e.setStyle("opacity",o)})),n.highlight&&n.highlight()}var m=n.extendShape({shape:{x1:0,y1:0,x2:0,y2:0,cpx1:0,cpy1:0,cpx2:0,cpy2:0,extent:0,orient:""},buildPath:function(e,t){var o=t.extent;e.moveTo(t.x1,t.y1),e.bezierCurveTo(t.cpx1,t.cpy1,t.cpx2,t.cpy2,t.x2,t.y2),"vertical"===t.orient?(e.lineTo(t.x2+o,t.y2),e.bezierCurveTo(t.cpx2+o,t.cpy2,t.cpx1+o,t.cpy1,t.x1+o,t.y1)):(e.lineTo(t.x2,t.y2+o),e.bezierCurveTo(t.cpx2,t.cpy2+o,t.cpx1,t.cpy1+o,t.x1,t.y1+o)),e.closePath()},highlight:function(){this.trigger("emphasis")},downplay:function(){this.trigger("normal")}}),L=d.extendChartView({type:"sankey",_model:null,_focusAdjacencyDisabled:!1,render:function(e,t,o){var d=this,r=e.getGraph(),l=this.group,c=e.layoutInfo,y=c.width,h=c.height,f=e.getData(),v=e.getData("edge"),x=e.get("orient");this._model=e,l.removeAll(),l.attr("position",[c.x,c.y]),r.eachEdge((function(t){var o=new m;o.dataIndex=t.dataIndex,o.seriesIndex=e.seriesIndex,o.dataType="edge";var d,r,c,f,L,I,E,N,A=t.getModel("lineStyle"),w=A.get("curveness"),D=t.node1.getLayout(),j=t.node1.getModel(),M=j.get("localX"),S=j.get("localY"),T=t.node2.getLayout(),_=t.node2.getModel(),G=_.get("localX"),H=_.get("localY"),V=t.getLayout();switch(o.shape.extent=Math.max(1,V.dy),o.shape.orient=x,"vertical"===x?(d=(null!=M?M*y:D.x)+V.sy,r=(null!=S?S*h:D.y)+D.dy,c=(null!=G?G*y:T.x)+V.ty,L=d,I=r*(1-w)+(f=null!=H?H*h:T.y)*w,E=c,N=r*w+f*(1-w)):(d=(null!=M?M*y:D.x)+D.dx,r=(null!=S?S*h:D.y)+V.sy,L=d*(1-w)+(c=null!=G?G*y:T.x)*w,I=r,E=d*w+c*(1-w),N=f=(null!=H?H*h:T.y)+V.ty),o.setShape({x1:d,y1:r,x2:c,y2:f,cpx1:L,cpy1:I,cpx2:E,cpy2:N}),o.setStyle(A.getItemStyle()),o.style.fill){case"source":o.style.fill=t.node1.getVisual("color");break;case"target":o.style.fill=t.node2.getVisual("color")}n.setHoverStyle(o,t.getModel("emphasis.lineStyle").getItemStyle()),l.add(o),v.setItemGraphicEl(t.dataIndex,o)})),r.eachNode((function(t){var o=t.getLayout(),d=t.getModel(),r=d.get("localX"),c=d.get("localY"),v=d.getModel("label"),x=d.getModel("emphasis.label"),rect=new n.Rect({shape:{x:null!=r?r*y:o.x,y:null!=c?c*h:o.y,width:o.dx,height:o.dy},style:d.getModel("itemStyle").getItemStyle()}),m=t.getModel("emphasis.itemStyle").getItemStyle();n.setLabelStyle(rect.style,m,v,x,{labelFetcher:e,labelDataIndex:t.dataIndex,defaultText:t.id,isRectText:!0}),rect.setStyle("fill",t.getVisual("color")),n.setHoverStyle(rect,m),l.add(rect),f.setItemGraphicEl(t.dataIndex,rect),rect.dataType="node"})),f.eachItemGraphicEl((function(t,n){var r=f.getItemModel(n);r.get("draggable")&&(t.drift=function(t,r){d._focusAdjacencyDisabled=!0,this.shape.x+=t,this.shape.y+=r,this.dirty(),o.dispatchAction({type:"dragNode",seriesId:e.id,dataIndex:f.getRawIndex(n),localX:this.shape.x/y,localY:this.shape.y/h})},t.ondragend=function(){d._focusAdjacencyDisabled=!1},t.draggable=!0,t.cursor="move"),t.highlight=function(){this.trigger("emphasis")},t.downplay=function(){this.trigger("normal")},t.focusNodeAdjHandler&&t.off("mouseover",t.focusNodeAdjHandler),t.unfocusNodeAdjHandler&&t.off("mouseout",t.unfocusNodeAdjHandler),r.get("focusNodeAdjacency")&&(t.on("mouseover",t.focusNodeAdjHandler=function(){d._focusAdjacencyDisabled||(d._clearTimer(),o.dispatchAction({type:"focusNodeAdjacency",seriesId:e.id,dataIndex:t.dataIndex}))}),t.on("mouseout",t.unfocusNodeAdjHandler=function(){d._focusAdjacencyDisabled||d._dispatchUnfocus(o)}))})),v.eachItemGraphicEl((function(t,n){var r=v.getItemModel(n);t.focusNodeAdjHandler&&t.off("mouseover",t.focusNodeAdjHandler),t.unfocusNodeAdjHandler&&t.off("mouseout",t.unfocusNodeAdjHandler),r.get("focusNodeAdjacency")&&(t.on("mouseover",t.focusNodeAdjHandler=function(){d._focusAdjacencyDisabled||(d._clearTimer(),o.dispatchAction({type:"focusNodeAdjacency",seriesId:e.id,edgeDataIndex:t.dataIndex}))}),t.on("mouseout",t.unfocusNodeAdjHandler=function(){d._focusAdjacencyDisabled||d._dispatchUnfocus(o)}))})),!this._data&&e.get("animation")&&l.setClipPath(function(rect,e,t){var o=new n.Rect({shape:{x:rect.x-10,y:rect.y-10,width:0,height:rect.height+20}});return n.initProps(o,{shape:{width:rect.width+20}},e,t),o}(l.getBoundingRect(),e,(function(){l.removeClipPath()}))),this._data=e.getData()},dispose:function(){this._clearTimer()},_dispatchUnfocus:function(e){var t=this;this._clearTimer(),this._unfocusDelayTimer=setTimeout((function(){t._unfocusDelayTimer=null,e.dispatchAction({type:"unfocusNodeAdjacency",seriesId:t._model.id})}),500)},_clearTimer:function(){this._unfocusDelayTimer&&(clearTimeout(this._unfocusDelayTimer),this._unfocusDelayTimer=null)},focusNodeAdjacency:function(e,t,o,n){var data=e.getData(),d=data.graph,f=n.dataIndex,m=data.getItemModel(f),L=n.edgeDataIndex;if(null!=f||null!=L){var I=d.getNodeByIndex(f),E=d.getEdgeByIndex(L);if(d.eachNode((function(e){v(e,l,.1)})),d.eachEdge((function(e){v(e,y,.1)})),I){x(I,c);var N=m.get("focusNodeAdjacency");"outEdges"===N?r.each(I.outEdges,(function(e){e.dataIndex<0||(x(e,h),x(e.node2,c))})):"inEdges"===N?r.each(I.inEdges,(function(e){e.dataIndex<0||(x(e,h),x(e.node1,c))})):"allEdges"===N&&r.each(I.edges,(function(e){e.dataIndex<0||(x(e,h),e.node1!==I&&x(e.node1,c),e.node2!==I&&x(e.node2,c))}))}E&&(x(E,h),x(E.node1,c),x(E.node2,c))}},unfocusNodeAdjacency:function(e,t,o,n){var d=e.getGraph();d.eachNode((function(e){v(e,l)})),d.eachEdge((function(e){v(e,y)}))}});e.exports=L},1489:function(e,t,o){var n=o(12);o(749),n.registerAction({type:"dragNode",event:"dragnode",update:"update"},(function(e,t){t.eachComponent({mainType:"series",subType:"sankey",query:e},(function(t){t.setNodePosition(e.dataIndex,[e.localX,e.localY])}))}))},1490:function(e,t,o){var n=o(59),d=o(1),r=o(42).groupData;function l(e){var t=e.hostGraph.data.getRawDataItem(e.dataIndex);return null!=t.depth&&t.depth>=0}function c(e,t,o,n,r){var l="vertical"===r?"x":"y";d.each(e,(function(e){var d,c,y;e.sort((function(a,b){return a.getLayout()[l]-b.getLayout()[l]}));for(var h=0,f=e.length,v="vertical"===r?"dx":"dy",i=0;i<f;i++)(y=h-(c=e[i]).getLayout()[l])>0&&(d=c.getLayout()[l]+y,"vertical"===r?c.setLayout({x:d},!0):c.setLayout({y:d},!0)),h=c.getLayout()[l]+c.getLayout()[v]+t;if((y=h-t-("vertical"===r?n:o))>0)for(d=c.getLayout()[l]-y,"vertical"===r?c.setLayout({x:d},!0):c.setLayout({y:d},!0),h=d,i=f-2;i>=0;--i)(y=(c=e[i]).getLayout()[l]+c.getLayout()[v]+t-h)>0&&(d=c.getLayout()[l]-y,"vertical"===r?c.setLayout({x:d},!0):c.setLayout({y:d},!0)),h=c.getLayout()[l]}))}function y(e,t,o){d.each(e.slice().reverse(),(function(e){d.each(e,(function(e){if(e.outEdges.length){var n=I(e.outEdges,h,o)/I(e.outEdges,L,o);if(isNaN(n)){var d=e.outEdges.length;n=d?I(e.outEdges,f,o)/d:0}if("vertical"===o){var r=e.getLayout().x+(n-m(e,o))*t;e.setLayout({x:r},!0)}else{var l=e.getLayout().y+(n-m(e,o))*t;e.setLayout({y:l},!0)}}}))}))}function h(e,t){return m(e.node2,t)*e.getValue()}function f(e,t){return m(e.node2,t)}function v(e,t){return m(e.node1,t)*e.getValue()}function x(e,t){return m(e.node1,t)}function m(e,t){return"vertical"===t?e.getLayout().x+e.getLayout().dx/2:e.getLayout().y+e.getLayout().dy/2}function L(e){return e.getValue()}function I(e,t,o){for(var n=0,d=e.length,i=-1;++i<d;){var r=+t.call(e,e[i],o);isNaN(r)||(n+=r)}return n}function E(e,t,o){d.each(e,(function(e){d.each(e,(function(e){if(e.inEdges.length){var n=I(e.inEdges,v,o)/I(e.inEdges,L,o);if(isNaN(n)){var d=e.inEdges.length;n=d?I(e.inEdges,x,o)/d:0}if("vertical"===o){var r=e.getLayout().x+(n-m(e,o))*t;e.setLayout({x:r},!0)}else{var l=e.getLayout().y+(n-m(e,o))*t;e.setLayout({y:l},!0)}}}))}))}e.exports=function(e,t,o){e.eachSeriesByType("sankey",(function(e){var o=e.get("nodeWidth"),h=e.get("nodeGap"),f=function(e,t){return n.getLayoutRect(e.getBoxLayoutParams(),{width:t.getWidth(),height:t.getHeight()})}(e,t);e.layoutInfo=f;var v=f.width,x=f.height,m=e.getGraph(),N=m.nodes,A=m.edges;!function(e){d.each(e,(function(e){var t=I(e.outEdges,L),o=I(e.inEdges,L),n=e.getValue()||0,d=Math.max(t,o,n);e.setLayout({value:d},!0)}))}(N),function(e,t,o,n,h,f,v,x,m){(function(e,t,o,n,r,c,y){for(var h=[],f=[],v=[],x=[],m=0,i=0;i<t.length;i++)h[i]=1;for(i=0;i<e.length;i++)f[i]=e[i].inEdges.length,0===f[i]&&v.push(e[i]);var L=-1;for(;v.length;){for(var I=0;I<v.length;I++){var E=v[I],N=E.hostGraph.data.getRawDataItem(E.dataIndex),A=null!=N.depth&&N.depth>=0;A&&N.depth>L&&(L=N.depth),E.setLayout({depth:A?N.depth:m},!0),"vertical"===c?E.setLayout({dy:o},!0):E.setLayout({dx:o},!0);for(var w=0;w<E.outEdges.length;w++){var D=E.outEdges[w];h[t.indexOf(D)]=0;var j=D.node2;0==--f[e.indexOf(j)]&&x.indexOf(j)<0&&x.push(j)}}++m,v=x,x=[]}for(i=0;i<h.length;i++)if(1===h[i])throw new Error("Sankey is a DAG, the original data has cycle!");var M=L>m-1?L:m-1;y&&"left"!==y&&function(e,t,o,n){if("right"===t){for(var r=[],c=e,y=0;c.length;){for(var i=0;i<c.length;i++){var h=c[i];h.setLayout({skNodeHeight:y},!0);for(var f=0;f<h.inEdges.length;f++){var v=h.inEdges[f];r.indexOf(v.node1)<0&&r.push(v.node1)}}c=r,r=[],++y}d.each(e,(function(e){l(e)||e.setLayout({depth:Math.max(0,n-e.getLayout().skNodeHeight)},!0)}))}else"justify"===t&&function(e,t){d.each(e,(function(e){l(e)||e.outEdges.length||e.setLayout({depth:t},!0)}))}(e,n)}(e,y,0,M);!function(e,t,o){d.each(e,(function(e){var n=e.getLayout().depth*t;"vertical"===o?e.setLayout({y:n},!0):e.setLayout({x:n},!0)}))}(e,"vertical"===c?(r-o)/M:(n-o)/M,c)})(e,t,o,h,f,x,m),function(e,t,o,n,l,h,f){var v=function(e,t){var o=[],n="vertical"===t?"y":"x",l=r(e,(function(e){return e.getLayout()[n]}));return l.keys.sort((function(a,b){return a-b})),d.each(l.keys,(function(e){o.push(l.buckets.get(e))})),o}(e,f);(function(e,t,o,n,r,l){var c=1/0;d.each(e,(function(e){var t=e.length,y=0;d.each(e,(function(e){y+=e.getLayout().value}));var h="vertical"===l?(n-(t-1)*r)/y:(o-(t-1)*r)/y;h<c&&(c=h)})),d.each(e,(function(e){d.each(e,(function(e,i){var t=e.getLayout().value*c;"vertical"===l?(e.setLayout({x:i},!0),e.setLayout({dx:t},!0)):(e.setLayout({y:i},!0),e.setLayout({dy:t},!0))}))})),d.each(t,(function(e){var t=+e.getValue()*c;e.setLayout({dy:t},!0)}))})(v,t,o,n,l,f),c(v,l,o,n,f);for(var x=1;h>0;h--)y(v,x*=.99,f),c(v,l,o,n,f),E(v,x,f),c(v,l,o,n,f)}(e,t,f,h,n,v,x),function(e,t){var o="vertical"===t?"x":"y";d.each(e,(function(e){e.outEdges.sort((function(a,b){return a.node2.getLayout()[o]-b.node2.getLayout()[o]})),e.inEdges.sort((function(a,b){return a.node1.getLayout()[o]-b.node1.getLayout()[o]}))})),d.each(e,(function(e){var t=0,o=0;d.each(e.outEdges,(function(e){e.setLayout({sy:t},!0),t+=e.getLayout().dy})),d.each(e.inEdges,(function(e){e.setLayout({ty:o},!0),o+=e.getLayout().dy}))}))}(e,x)}(N,A,o,h,v,x,0!==d.filter(N,(function(e){return 0===e.getLayout().value})).length?0:e.get("layoutIterations"),e.get("orient"),e.get("nodeAlign"))}))}},1491:function(e,t,o){var n=o(224),d=o(1);e.exports=function(e,t){e.eachSeriesByType("sankey",(function(e){var t=e.getGraph().nodes;if(t.length){var o=1/0,r=-1/0;d.each(t,(function(e){var t=e.getLayout().value;t<o&&(o=t),t>r&&(r=t)})),d.each(t,(function(t){var d=new n({type:"color",mappingMethod:"linear",dataExtent:[o,r],visual:e.get("color")}).mapValueToVisual(t.getLayout().value),l=t.getModel().get("itemStyle.color");null!=l?t.setVisual("color",l):t.setVisual("color",d)}))}}))}}}]);